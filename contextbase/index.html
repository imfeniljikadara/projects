<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContextBase - Project Overview</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        h2 {
            color: #1e40af;
            margin-top: 40px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
        }
        h3 {
            color: #3b82f6;
            margin-top: 30px;
        }
        .diagram-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: auto;
        }
        /* Enhanced styling for diagrams */
        .diagram-container.enhanced {
            padding: 40px;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            margin: 40px 0;
            overflow-x: auto;
        }
        .diagram {
            width: 100%;
            height: auto;
            margin: 0 auto;
        }
        .component-box {
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            background-color: #f0f7ff;
        }
        .file-structure {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            white-space: pre;
            overflow-x: auto;
        }
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        .tech-item {
            background-color: #e0e7ff;
            color: #4338ca;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
        }
        .flow-diagram {
            text-align: center;
            margin: 30px 0;
        }
        .mermaid {
            margin: 0 auto;
            overflow: auto;
            font-size: 18px;
        }
        /* Enhanced styling for diagrams */
        .diagram-container.enhanced {
            padding: 40px;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            margin: 40px 0;
            overflow-x: auto;
        }
        /* Code snippet styling */
        .code-snippet {
            background-color: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            line-height: 1.5;
        }
        .code-snippet .comment { color: #6a9955; }
        .code-snippet .keyword { color: #569cd6; }
        .code-snippet .string { color: #ce9178; }
        .code-snippet .function { color: #dcdcaa; }
        .code-snippet .variable { color: #9cdcfe; }
        .code-snippet .type { color: #4ec9b0; }
        
        /* Visual comparison table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th {
            background-color: #e0e7ff;
            color: #4338ca;
            padding: 12px;
            text-align: left;
        }
        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        /* Feature cards */
        .feature-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        .feature-card {
            flex: 1 1 300px;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .feature-card h3 {
            color: #3b82f6;
            margin-top: 0;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        /* Process steps */
        .process-steps {
            counter-reset: step;
            margin: 30px 0;
        }
        .process-step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }
        .process-step::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 40px;
            height: 40px;
            background-color: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Color coding for different components */
        .auth-color { color: #3b82f6; }
        .memory-color { color: #22c55e; }
        .db-color { color: #ef4444; }
        .api-color { color: #8b5cf6; }
        
        /* Tabs for code examples */
        .tabs {
            display: flex;
            margin-bottom: -1px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            cursor: pointer;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
        }
        .tab-content {
            display: none;
            border: 1px solid #e2e8f0;
            border-radius: 0 8px 8px 8px;
            padding: 20px;
            background-color: white;
        }
        .tab-content.active {
            display: block;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({ 
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose',
                flowchart: { 
                    useMaxWidth: true,
                    htmlLabels: true,
                    curve: 'linear',
                    nodeSpacing: 80,
                    rankSpacing: 100
                }
            });
        });
    </script>
</head>
<body>
    <header>
        <h1>ContextBase - Project Overview</h1>
        <p>A Model Context Protocol (MCP) server for AI agents, assistants, and apps</p>
        <div class="project-links" style="display: flex; justify-content: center; gap: 30px; margin-top: 20px;">
            <a href="https://github.com/imfeniljikadara/contextbase" target="_blank" rel="noopener noreferrer" style="display: flex; align-items: center; text-decoration: none; color: #333;">
                <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo" style="width: 30px; height: 30px; margin-right: 8px;">
                <span>GitHub Repository</span>
            </a>
            <a href="https://contextbase.onrender.com" target="_blank" rel="noopener noreferrer" style="display: flex; align-items: center; text-decoration: none; color: #333;">
                <img src="https://cdn-icons-png.flaticon.com/512/2301/2301129.png" alt="Website Globe Icon" style="width: 30px; height: 30px; margin-right: 8px;">
                <span>Live MCP Server</span>
            </a>
        </div>
    </header>

    <h2>Project Description</h2>
    <p>
        ContextBase is a Model Context Protocol (MCP) server designed to store, retrieve, and manage per-user context for AI applications.
        It provides a simple API for AI agents and assistants to maintain user-specific context across interactions, enabling more personalized
        and contextually aware AI experiences.
    </p>
    <p>
        The system uses a combination of Redis for high-performance caching and PostgreSQL for persistent storage, with a secure authentication
        system to ensure that context data is properly isolated between users.
    </p>

    <h2>Key Features</h2>
    <div class="feature-cards">
        <div class="feature-card">
            <h3><span class="auth-color">üîê</span> Authentication System</h3>
            <p>Secure user authentication using JWT tokens and bcrypt password hashing ensures that only authorized users can access their context data.</p>
            <ul>
                <li>User registration and login</li>
                <li>JWT-based authentication</li>
                <li>Password hashing with bcrypt</li>
                <li>Token verification middleware</li>
            </ul>
        </div>
        <div class="feature-card">
            <h3><span class="memory-color">üß†</span> Memory Management</h3>
            <p>Efficient storage and retrieval of context data with Redis for high-performance caching and flexible TTL support.</p>
            <ul>
                <li>Create/read/update/delete operations</li>
                <li>Namespace isolation per user</li>
                <li>Optional TTL for expiring context</li>
                <li>Search capabilities</li>
            </ul>
        </div>
        <div class="feature-card">
            <h3><span class="db-color">üìä</span> Logging System</h3>
            <p>Comprehensive logging of user actions for auditing, debugging, and analytics purposes.</p>
            <ul>
                <li>Action tracking (create, update, delete)</li>
                <li>Timestamp recording</li>
                <li>User association</li>
                <li>Key-based filtering</li>
            </ul>
        </div>
    </div>
    <div class="feature-cards">
        <div class="feature-card">
            <h3><span class="api-color">üöÄ</span> Modern Tech Stack</h3>
            <p>Built with cutting-edge technologies for performance, type safety, and developer experience.</p>
            <ul>
                <li>TypeScript for type safety</li>
                <li>Fastify for high-performance API</li>
                <li>Prisma ORM for database access</li>
                <li>Zod for request validation</li>
            </ul>
        </div>
        <div class="feature-card">
            <h3><span class="db-color">üíæ</span> Database Integration</h3>
            <p>PostgreSQL for reliable, persistent storage of user data and action logs.</p>
            <ul>
                <li>Prisma migrations</li>
                <li>Relational data model</li>
                <li>Efficient queries</li>
                <li>Data integrity</li>
            </ul>
        </div>
        <div class="feature-card">
            <h3><span class="memory-color">‚ö°</span> Caching</h3>
            <p>Redis for lightning-fast in-memory caching of context data with minimal latency.</p>
            <ul>
                <li>In-memory key-value store</li>
                <li>Sub-millisecond response times</li>
                <li>Expiration policies</li>
                <li>Pattern-based key search</li>
            </ul>
        </div>
    </div>

    <h2>Technology Stack</h2>
    <div class="tech-stack">
        <div class="tech-item">TypeScript</div>
        <div class="tech-item">Node.js</div>
        <div class="tech-item">Fastify</div>
        <div class="tech-item">Prisma ORM</div>
        <div class="tech-item">PostgreSQL</div>
        <div class="tech-item">Redis</div>
        <div class="tech-item">JWT</div>
        <div class="tech-item">Docker</div>
        <div class="tech-item">Zod</div>
    </div>

    <h2>High-Level Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    Client[Client Applications] --- API[ContextBase API]
    API --- Auth[Authentication Service]
    API --- Memory[Memory Service]
    API --- Logs[Logging Service]
    Memory --- Redis[Redis Cache]
    Logs --- PostgreSQL[PostgreSQL Database]
    Auth --- PostgreSQL
    
    subgraph "Core Components"
        APIRoutes[API Routes] --- Controllers[Controllers]
        Controllers --- Services[Services]
        Services --- Models[Data Models]
        Models --- Database[Database Layer]
    end
    
    API --- Core_Components[Core Components]
    
    classDef client fill:#d1e7dd,stroke:#20c997;
    classDef api fill:#cfe2ff,stroke:#0d6efd;
    classDef service fill:#e2e3e5,stroke:#6c757d;
    classDef storage fill:#f8d7da,stroke:#dc3545;
    
    class Client client;
    class API api;
    class Auth,Memory,Logs service;
    class Redis,PostgreSQL storage;
        </div>
    </div>

    <h2>Detailed Component Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "API Layer"
        Routes[API Routes] --> AuthRoutes[Auth Routes]
        Routes --> MemoryRoutes[Memory Routes]
        Routes --> LogRoutes[Log Routes]
        
        AuthRoutes --> Register[Register Endpoint]
        AuthRoutes --> Login[Login Endpoint]
        
        MemoryRoutes --> CreateMemory[Create Memory]
        MemoryRoutes --> GetMemory[Get Memory]
        MemoryRoutes --> UpdateMemory[Update Memory]
        MemoryRoutes --> DeleteMemory[Delete Memory]
        MemoryRoutes --> ListMemories[List Memories]
        MemoryRoutes --> SearchMemories[Search Memories]
        
        LogRoutes --> GetLogs[Get User Logs]
    end
    
    subgraph "Service Layer"
        AuthService[Auth Service] --> HashPassword[Hash Password]
        AuthService --> VerifyPassword[Verify Password]
        AuthService --> GenerateToken[Generate JWT]
        
        MemoryService[Memory Service] --> StoreContext[Store Context]
        MemoryService --> GetContext[Get Context]
        MemoryService --> UpdateContext[Update Context]
        MemoryService --> DeleteContext[Delete Context]
        MemoryService --> ListContextKeys[List Context Keys]
        MemoryService --> SearchContext[Search Context]
        
        LogService[Log Service] --> LogAction[Log User Action]
        LogService --> GetUserLogs[Get User Logs]
    end
    
    subgraph "Data Layer"
        Redis[Redis Cache] --> KeyValueStore[Key-Value Store]
        Redis --> TTLSupport[TTL Support]
        
        PostgreSQL[PostgreSQL] --> UserModel[User Model]
        PostgreSQL --> LogModel[Log Model]
    end
    
    AuthRoutes --> AuthService
    MemoryRoutes --> MemoryService
    LogRoutes --> LogService
    
    MemoryService --> Redis
    LogService --> PostgreSQL
    AuthService --> PostgreSQL
    
    classDef api fill:#f0f7ff,stroke:#3b82f6;
    classDef service fill:#f0fdf4,stroke:#22c55e;
    classDef data fill:#fef3c7,stroke:#d97706;
    
    class API_Layer api;
    class Service_Layer service;
    class Data_Layer data;
        </div>
    </div>

    <h2>Project Structure</h2>
    <div class="file-structure">
mcp/
‚îú‚îÄ‚îÄ mcp-server/             # Main server application
‚îÇ   ‚îú‚îÄ‚îÄ prisma/             # Database schema and migrations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/     # Database migrations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma   # Prisma schema definition
‚îÇ   ‚îú‚îÄ‚îÄ src/                # Source code
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/            # API routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts     # Authentication routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts    # API routes index
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logs.ts     # Logging routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ memory.ts   # Memory management routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/         # Configuration files
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/             # Database connections
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres.ts # PostgreSQL connection
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis.ts    # Redis connection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # Custom middleware
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.ts     # Authentication middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/         # Data models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/       # Business logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logService.ts   # Logging service
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ memoryService.ts # Memory service
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/          # Utility functions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts        # Application entry point
‚îÇ   ‚îú‚îÄ‚îÄ scripts/            # Helper scripts
‚îÇ   ‚îú‚îÄ‚îÄ .env                # Environment variables
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml  # Docker configuration
‚îÇ   ‚îú‚îÄ‚îÄ package.json        # Dependencies and scripts
‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json       # TypeScript configuration
‚îú‚îÄ‚îÄ .env.example            # Example environment variables
‚îú‚îÄ‚îÄ .gitignore              # Git ignore file
‚îú‚îÄ‚îÄ LICENSE                 # License file
‚îî‚îÄ‚îÄ README.md               # Project documentation
</div>

    <h2>Data Flow Diagram</h2>
    <div class="diagram-container">
        <div class="mermaid">
            sequenceDiagram
                participant Client as Client Application
                participant API as ContextBase API
                participant Auth as Auth Service
                participant Memory as Memory Service
                participant Redis as Redis Cache
                participant DB as PostgreSQL
                participant Logs as Logging Service
                
                Note over Client,Logs: Authentication Flow
                Client->>API: Register (email, password)
                API->>Auth: Hash Password & Create User
                Auth->>DB: Store User Data
                DB->>Auth: User Created
                Auth->>API: User Created
                API->>Client: Registration Success
                
                Client->>API: Login (email, password)
                API->>Auth: Verify Credentials
                Auth->>DB: Fetch User Data
                DB->>Auth: User Data
                Auth->>Auth: Verify Password
                Auth->>API: Generate JWT Token
                API->>Client: Return JWT Token
                
                Note over Client,Logs: Memory Operations Flow
                Client->>API: Store Context (with JWT)
                API->>Auth: Validate JWT
                Auth->>API: User Authenticated
                API->>Memory: Store Context
                Memory->>Redis: Set Key-Value
                Memory->>Logs: Log Action
                Logs->>DB: Store Log Entry
                Redis->>Memory: Storage Confirmed
                Memory->>API: Context Stored
                API->>Client: Success Response
                
                Client->>API: Get Context (with JWT)
                API->>Auth: Validate JWT
                Auth->>API: User Authenticated
                API->>Memory: Get Context
                Memory->>Redis: Get Value by Key
                Redis->>Memory: Return Value
                Memory->>API: Return Context
                API->>Client: Context Data
        </div>
    </div>

    <h2>API Endpoints</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    subgraph "Authentication API"
        Register["/api/auth/register"] --- RegisterPost["POST - Register User"]
        Login["/api/auth/login"] --- LoginPost["POST - Login User"]
    end
    
    subgraph "Memory API"
        MemoryRoot["/api/memory"] --- MemoryGet["GET - List All Memories"]
        MemoryRoot --- MemoryPost["POST - Create Memory"]
        MemoryKey["/api/memory/:key"] --- MemoryKeyGet["GET - Get Memory"]
        MemoryKey --- MemoryKeyPatch["PATCH - Update Memory"]
        MemoryKey --- MemoryKeyDelete["DELETE - Delete Memory"]
        MemorySearch["/api/memory/search/:query"] --- MemorySearchGet["GET - Search Memories"]
        MemoryDelete["/api/memory/delete"] --- MemoryDeletePost["POST - Delete Memory (Alternative)"]
    end
    
    subgraph "Logs API"
        LogsRoot["/api/logs"] --- LogsGet["GET - Get User Logs"]
    end
    
    classDef auth fill:#dbeafe,stroke:#3b82f6;
    classDef memory fill:#dcfce7,stroke:#22c55e;
    classDef logs fill:#fef3c7,stroke:#d97706;
    
    class Authentication_API auth;
    class Memory_API memory;
    class Logs_API logs;
        </div>
    </div>

    <h2>Authentication Flow</h2>
    <div class="diagram-container enhanced">
        <div class="mermaid">
graph LR
    A["Start"] --> B["User Registration"]
    B --> C["Hash Password"]
    C --> D["Store User in DB"]
    D --> E["User Created"]
    
    F["Login Request"] --> G["Fetch User from DB"]
    G --> H["Verify Password"]
    H --> I["Generate JWT Token"]
    I --> J["Return Token to Client"]
    
    K["Protected API Request"] --> L["Extract JWT from Header"]
    L --> M["Verify Token"]
    M --> N["Decode User ID"]
    N --> O["Attach User to Request"]
    O --> P["Process Request"]
    
    style A fill:#d4f4e2,stroke:#34d399,stroke-width:3px,color:#065f46,font-weight:bold
    style E fill:#d4f4e2,stroke:#34d399,stroke-width:3px,color:#065f46,font-weight:bold
    style J fill:#d4f4e2,stroke:#34d399,stroke-width:3px,color:#065f46,font-weight:bold
    style P fill:#d4f4e2,stroke:#34d399,stroke-width:3px,color:#065f46,font-weight:bold
        </div>
    </div>

    <h3>Authentication Implementation</h3>
    <div class="diagram-container enhanced">
        <div class="mermaid">
sequenceDiagram
    participant Client as Client
    participant Auth as Auth API
    participant Bcrypt as Password Hasher
    participant DB as PostgreSQL
    participant JWT as JWT Service
    
    Note over Client,JWT: User Registration Flow
    Client->>Auth: POST /api/auth/register
    Note right of Client: {email: "user@example.com", password: "securepassword"}
    Auth->>Bcrypt: Hash Password
    Bcrypt->>Auth: Return Hashed Password
    Auth->>DB: Create User Record
    DB->>Auth: User Created
    Auth->>Client: Return User ID
    
    Note over Client,JWT: User Login Flow
    Client->>Auth: POST /api/auth/login
    Note right of Client: {email: "user@example.com", password: "securepassword"}
    Auth->>DB: Find User by Email
    DB->>Auth: Return User Record
    Auth->>Bcrypt: Compare Passwords
    Bcrypt->>Auth: Password Valid/Invalid
    Auth->>JWT: Generate Token
    JWT->>Auth: Return JWT Token
    Auth->>Client: Return JWT Token
    
    Note over Client,JWT: Request Authentication
    Client->>Auth: Request Protected Endpoint
    Note right of Client: Authorization: Bearer {token}
    Auth->>JWT: Verify Token
    JWT->>Auth: Token Valid/Invalid
    Auth->>Auth: Extract User ID
    Auth->>Client: Process Request
        </div>
    </div>
    
    <h3>Authentication Components</h3>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Authentication System"
        Register["User Registration"] --> ValidateInput["Validate Input Data"]
        ValidateInput --> CheckExisting["Check Existing User"]
        CheckExisting --> HashPassword["Hash Password"]
        HashPassword --> StoreUser["Store User in Database"]
        
        Login["User Login"] --> FindUser["Find User by Email"]
        FindUser --> VerifyPassword["Verify Password"]
        VerifyPassword --> GenerateToken["Generate JWT Token"]
        
        Middleware["Auth Middleware"] --> ExtractToken["Extract Token from Header"]
        ExtractToken --> VerifyToken["Verify Token Signature"]
        VerifyToken --> DecodePayload["Decode Token Payload"]
        DecodePayload --> AttachUser["Attach User to Request"]
    end
    
    subgraph "Security Features"
        PasswordHashing["Password Hashing"] --> Bcrypt["Bcrypt Algorithm"]
        Bcrypt --> SaltRounds["10 Salt Rounds"]
        
        TokenSecurity["Token Security"] --> JWTAlgorithm["HS256 Algorithm"]
        JWTAlgorithm --> TokenExpiry["7 Day Expiry"]
        TokenExpiry --> SecretKey["Environment Secret Key"]
    end
    
    Register -.-> PasswordHashing
    Login -.-> PasswordHashing
    Login -.-> TokenSecurity
    Middleware -.-> TokenSecurity
    
    classDef auth fill:#f0f7ff,stroke:#3b82f6;
    classDef security fill:#dcfce7,stroke:#22c55e;
    
    class Authentication_System auth;
    class Security_Features security;
        </div>
    </div>

    <h2>API Usage Examples</h2>
    <div class="diagram-container enhanced">
        <div class="mermaid">
sequenceDiagram
    participant Client as Client Application
    participant Auth as Auth API
    participant Memory as Memory API
    participant Redis as Redis Cache
    participant DB as PostgreSQL
    
    Note over Client,DB: Authentication Flow
    Client->>Auth: POST /api/auth/register
    Note right of Client: {email: "user@example.com", password: "securepassword"}
    Auth->>Client: {success: true, userId: "123e4567-e89b-12d3-a456-426614174000"}
    
    Client->>Auth: POST /api/auth/login
    Note right of Client: {email: "user@example.com", password: "securepassword"}
    Auth->>Client: {token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}
    
    Note over Client,DB: Memory Operations
    Client->>Memory: POST /api/memory
    Note right of Client: Authorization: Bearer {token}<br>{key: "user_preferences", value: {theme: "dark"}}
    Memory->>Redis: Store Key-Value
    Memory->>DB: Log Action
    Memory->>Client: {success: true}
    
    Client->>Memory: GET /api/memory/user_preferences
    Note right of Client: Authorization: Bearer {token}
    Memory->>Redis: Get Value
    Redis->>Memory: Return Value
    Memory->>Client: {value: {theme: "dark"}}
    
    Client->>Memory: PATCH /api/memory/user_preferences
    Note right of Client: Authorization: Bearer {token}<br>{value: {theme: "light"}}
    Memory->>Redis: Update Value
    Memory->>DB: Log Action
    Memory->>Client: {success: true}
    
    Client->>Memory: GET /api/memory
    Note right of Client: Authorization: Bearer {token}
    Memory->>Redis: List Keys
    Redis->>Memory: Return Keys
    Memory->>Client: {keys: ["user_preferences", "conversation_history"]}
    
    Client->>Memory: DELETE /api/memory/user_preferences
    Note right of Client: Authorization: Bearer {token}
    Memory->>Redis: Delete Key
    Memory->>DB: Log Action
    Memory->>Client: {success: true}
    
    Client->>Memory: GET /api/memory/search/user
    Note right of Client: Authorization: Bearer {token}
    Memory->>Redis: Pattern Search
    Redis->>Memory: Return Matching Keys
    Memory->>Client: {results: ["user_preferences", "user_history"]}
        </div>
    </div>
    
    <h3>API Endpoints Visual Map</h3>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Authentication API"
        AuthRoot["Authentication API<br>/api/auth"] --> Register["POST /register<br>Create new user account"]
        AuthRoot --> Login["POST /login<br>Authenticate and get token"]
    end
    
    subgraph "Memory API"
        MemoryRoot["Memory API<br>/api/memory"] --> CreateMemory["POST /<br>Create new memory entry"]
        MemoryRoot --> ListMemories["GET /<br>List all memory keys"]
        MemoryRoot --> GetMemory["GET /:key<br>Get specific memory value"]
        MemoryRoot --> UpdateMemory["PATCH /:key<br>Update memory value"]
        MemoryRoot --> DeleteMemory["DELETE /:key<br>Delete memory entry"]
        MemoryRoot --> SearchMemory["GET /search/:query<br>Search memory keys"]
        MemoryRoot --> PostDelete["POST /delete<br>Alternative delete method"]
    end
    
    subgraph "Logs API"
        LogsRoot["Logs API<br>/api/logs"] --> GetLogs["GET /<br>Get user action logs"]
    end
    
    AuthRoot -.-> MemoryRoot
    AuthRoot -.-> LogsRoot
    
    classDef auth fill:#f0f7ff,stroke:#3b82f6;
    classDef memory fill:#dcfce7,stroke:#22c55e;
    classDef logs fill:#fef3c7,stroke:#d97706;
    
    class Authentication_API,Register,Login auth;
    class Memory_API,CreateMemory,ListMemories,GetMemory,UpdateMemory,DeleteMemory,SearchMemory,PostDelete memory;
    class Logs_API,GetLogs logs;
        </div>
    </div>

    <h2>Memory Service Implementation</h2>
    <div class="diagram-container enhanced">
        <div class="mermaid">
graph TD
    subgraph "Memory Service Functions"
        StoreContext["storeContext()"] --> NamespaceKey1["Create Namespaced Key<br>userId:key"]
        NamespaceKey1 --> SetRedis["Set in Redis<br>JSON.stringify(value)"]
        SetRedis --> SetTTL["Set TTL (Optional)<br>redis.expire(key, ttl)"]
        SetTTL --> LogCreate["Log Action<br>logAction(userId, 'create', key)"]
        
        GetContext["getContext()"] --> NamespaceKey2["Create Namespaced Key<br>userId:key"]
        NamespaceKey2 --> GetRedis["Get from Redis<br>redis.get(key)"]
        GetRedis --> ParseJSON["Parse JSON Value<br>JSON.parse(value)"]
        
        UpdateContext["updateContext()"] --> NamespaceKey3["Create Namespaced Key<br>userId:key"]
        NamespaceKey3 --> CheckExists["Check if Key Exists<br>redis.exists(key)"]
        CheckExists --> UpdateRedis["Update in Redis<br>redis.set(key, JSON.stringify(newValue))"]
        UpdateRedis --> LogUpdate["Log Action<br>logAction(userId, 'update', key)"]
        
        DeleteContext["deleteContext()"] --> NamespaceKey4["Create Namespaced Key<br>userId:key"]
        NamespaceKey4 --> DeleteRedis["Delete from Redis<br>redis.del(key)"]
        DeleteRedis --> LogDelete["Log Action<br>logAction(userId, 'delete', key)"]
        
        ListContextKeys["listContextKeys()"] --> GetAllKeys["Get All User Keys<br>redis.keys(`${userId}:*`)"]
        GetAllKeys --> RemoveNamespace["Remove Namespace Prefix<br>key.split(':')[1]"]
        
        SearchContext["searchContext()"] --> GetAllKeys2["Get All User Keys<br>redis.keys(`${userId}:*`)"]
        GetAllKeys2 --> RemoveNamespace2["Remove Namespace Prefix<br>key.replace(`${userId}:`, '')"]
        RemoveNamespace2 --> FilterByQuery["Filter by Search Query<br>key.includes(query)"]
    end
    
    classDef memory fill:#f0f7ff,stroke:#3b82f6;
    class Memory_Service_Functions memory;
        </div>
    </div>
    
    <h3>Memory Service Architecture</h3>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Client Request Flow"
        APIRequest["API Request"] --> MemoryController["Memory Controller<br>(API Routes)"]
        MemoryController --> MemoryService["Memory Service<br>(Business Logic)"]
        MemoryService --> RedisAdapter["Redis Adapter<br>(Data Access)"]
        MemoryService --> LoggingService["Logging Service<br>(Audit Trail)"]
        RedisAdapter --> RedisDB["Redis Database<br>(Key-Value Store)"]
        LoggingService --> PostgresDB["PostgreSQL<br>(Persistent Storage)"]
    end
    
    subgraph "Key Namespacing"
        UserID["User ID<br>(From JWT Token)"] --> KeyPrefix["Key Prefix<br>userId:"]
        KeyPrefix --> KeyName["Key Name<br>(From Request)"]
        KeyName --> FullKey["Full Key<br>userId:keyName"]
        FullKey --> RedisKey["Redis Key"]
    end
    
    subgraph "Value Serialization"
        ValueObject["Value Object<br>(JavaScript Object)"] --> JSONString["JSON String<br>JSON.stringify()"]
        JSONString --> RedisValue["Redis Value<br>(String)"]
        RedisValue --> RetrievedString["Retrieved String"]
        RetrievedString --> ParsedObject["Parsed Object<br>JSON.parse()"]
    end
    
    MemoryService -.-> UserID
    MemoryService -.-> ValueObject
    RedisAdapter -.-> FullKey
    RedisAdapter -.-> JSONString
    
    classDef flow fill:#f0f7ff,stroke:#3b82f6;
    classDef keys fill:#dcfce7,stroke:#22c55e;
    classDef values fill:#fef3c7,stroke:#d97706;
    
    class Client_Request_Flow flow;
    class Key_Namespacing keys;
    class Value_Serialization values;
        </div>
    </div>

    <h2>Logging System</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant Memory as Memory Service
    participant Log as Log Service
    participant DB as PostgreSQL
    
    Note over Memory,DB: Logging User Actions
    
    Memory->>Log: logAction(userId, 'create', key)
    Log->>DB: Insert Log Entry
    DB->>Log: Log Created
    Log->>Memory: Action Logged
    
    Memory->>Log: logAction(userId, 'update', key)
    Log->>DB: Insert Log Entry
    DB->>Log: Log Created
    Log->>Memory: Action Logged
    
    Memory->>Log: logAction(userId, 'delete', key)
    Log->>DB: Insert Log Entry
    DB->>Log: Log Created
    Log->>Memory: Action Logged
        </div>
    </div>

    <h2>Redis Implementation</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Redis Operations"
        Connect["Connect to Redis"] --> ClientConfig["Configure Redis Client"]
        ClientConfig --> ConnectionPool["Setup Connection Pool"]
        
        Set["SET Operation"] --> NamespaceKey["Namespace Key with UserID"]
        NamespaceKey --> SerializeValue["Serialize Value to JSON"]
        SerializeValue --> StoreKeyValue["Store Key-Value Pair"]
        
        Get["GET Operation"] --> NamespaceKey2["Namespace Key with UserID"]
        NamespaceKey2 --> FetchValue["Fetch Value by Key"]
        FetchValue --> DeserializeValue["Deserialize JSON Value"]
        
        TTL["TTL Support"] --> SetExpiry["Set Key Expiration"]
        SetExpiry --> AutoDelete["Automatic Deletion"]
        
        Keys["KEYS Operation"] --> PatternMatch["Pattern Matching"]
        PatternMatch --> UserKeysPattern["User-specific Pattern"]
        UserKeysPattern --> ReturnMatchingKeys["Return Matching Keys"]
    end
    
    classDef redis fill:#f0f7ff,stroke:#3b82f6;
    class Redis_Operations redis;
        </div>
    </div>

    <h2>Development Workflow</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant Dev as Developer
    participant Git as Git Repository
    participant NPM as NPM
    participant TS as TypeScript Compiler
    participant Server as ContextBase Server
    participant DB as Database
    
    Dev->>Git: Clone Repository
    Dev->>NPM: npm install
    NPM->>Dev: Dependencies Installed
    Dev->>Dev: Configure .env
    Dev->>DB: Run Migrations (npx prisma migrate dev)
    DB->>Dev: Database Schema Created
    Dev->>NPM: npm run dev
    NPM->>TS: Compile TypeScript
    TS->>Server: Start Development Server
    Server->>Dev: Server Running
    Dev->>Server: Make API Requests
    Server->>Dev: API Responses
    Dev->>Git: Commit Changes
        </div>
    </div>

    <h2>Deployment Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    subgraph "Docker Compose Environment"
        API["ContextBase API Container"] --- Redis["Redis Container"]
        API --- Postgres["PostgreSQL Container"]
        
        API --- NodeJS["Node.js Runtime"]
        API --- TypeScript["TypeScript"]
        API --- Fastify["Fastify Server"]
        
        Redis --- RedisVolume["Redis Volume"]
        Postgres --- PostgresVolume["PostgreSQL Volume"]
    end
    
    Client["Client Applications"] --- API
    
    classDef container fill:#dbeafe,stroke:#3b82f6;
    classDef volume fill:#dcfce7,stroke:#22c55e;
    classDef external fill:#f0f7ff,stroke:#6c757d;
    
    class API,Redis,Postgres container;
    class RedisVolume,PostgresVolume volume;
    class Client external;
        </div>
    </div>

    <h2>Getting Started</h2>
    <p>To run the ContextBase server locally:</p>
    <ol>
        <li>Clone the repository
            <ul>
                <li><code>git clone https://github.com/imfeniljikadara/contextbase.git</code></li>
                <li><code>cd mcp</code></li>
            </ul>
        </li>
        <li>Install dependencies
            <ul>
                <li><code>cd mcp-server</code></li>
                <li><code>npm install</code></li>
            </ul>
        </li>
        <li>Configure environment variables
            <ul>
                <li>Create a <code>.env</code> file in the <code>mcp-server</code> directory</li>
                <li>Use the <code>.env.example</code> file as a template</li>
            </ul>
        </li>
        <li>Run database migrations
            <ul>
                <li><code>npx prisma migrate dev</code></li>
            </ul>
        </li>
        <li>Start the server
            <ul>
                <li>Development mode: <code>npm run dev</code></li>
                <li>Production mode: <code>npm start</code></li>
                <li>Using Docker: <code>docker-compose up</code></li>
            </ul>
        </li>
    </ol>

    <script>
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.querySelector(`#${tabId}`).classList.add('active');
        }
    </script>

    <h2>Conclusion</h2>
    <p>
        ContextBase is a powerful and flexible Model Context Protocol (MCP) server designed to enhance AI applications with persistent
        user context. Its architecture leverages modern technologies like Fastify, Redis, and PostgreSQL to provide a scalable and
        efficient solution for context management.
    </p>
    <p>
        The system's key strengths include:
    </p>
    <ul>
        <li>Secure per-user context isolation through authentication</li>
        <li>High-performance context storage and retrieval using Redis</li>
        <li>Comprehensive action logging for auditing and debugging</li>
        <li>Simple and intuitive API for easy integration</li>
        <li>Containerized deployment for simplified operations</li>
    </ul>
    <p>
        By providing these capabilities, ContextBase enables AI applications to maintain contextual awareness across user interactions,
        resulting in more personalized and effective AI experiences.
    </p>

    <footer style="margin-top: 50px; text-align: center; color: #6c757d; font-size: 0.9em;">
        <p>Created on April, 2025</p>
    </footer>

    <script>
        // Initialize all mermaid diagrams
        mermaid.init(undefined, document.querySelectorAll('.mermaid'));
    </script>
</body>
</html>
